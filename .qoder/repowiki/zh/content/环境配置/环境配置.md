# 环境配置

<cite>
**Referenced Files in This Document**   
- [application.properties](file://backend/src/main/resources/application.properties)
- [vite.config.js](file://frontend/vite.config.js)
- [README.md](file://README.md)
- [pom.xml](file://backend/pom.xml)
- [package.json](file://frontend/package.json)
- [BatchSelectionController.java](file://backend/src/main/java/com/example/batchselection/controller/BatchSelectionController.java)
</cite>

## 目录
1. [前置条件](#前置条件)
2. [后端环境配置](#后端环境配置)
3. [前端环境配置](#前端环境配置)
4. [跨域问题解决方案](#跨域问题解决方案)
5. [常见配置问题排查](#常见配置问题排查)
6. [总结](#总结)

## 前置条件

在开始配置开发环境之前，请确保系统已安装以下必要的软件和工具：

- **JDK 11+**：后端基于 Java 11 开发，需安装 JDK 11 或更高版本。项目中 `pom.xml` 文件显示使用的是 Java 8 兼容模式，但推荐使用 JDK 11 以获得更好的性能和安全性。
- **Maven 3.6+**：用于构建和管理后端项目的依赖。`pom.xml` 文件定义了 Spring Boot 2.7.14 及相关依赖。
- **Node.js 16+**：前端项目使用 Vite 构建，需要 Node.js 环境。`package.json` 显示依赖 Vite 5.0+ 和 React 18。
- **MySQL 8.0+**：数据库要求 MySQL 8.0 或更高版本，以确保与 `mysql-connector-java` 8.0.33 驱动兼容。

**Section sources**
- [pom.xml](file://backend/pom.xml#L22-L24)
- [package.json](file://frontend/package.json#L7-L14)
- [README.md](file://README.md#L97-L102)

## 后端环境配置

### 数据库连接配置

后端使用 Spring Boot 的 `application.properties` 文件进行数据库连接配置。主要配置项如下：

- **数据库 URL**：`spring.datasource.url` 配置了 MySQL 连接字符串，指向本地 `batch_selection` 数据库，并包含多个连接参数：
  - `useUnicode=true&characterEncoding=utf8`：确保 UTF-8 字符编码支持
  - `useSSL=false`：禁用 SSL 连接（开发环境）
  - `serverTimezone=Asia/Shanghai`：设置服务器时区为北京时间
  - `allowPublicKeyRetrieval=true`：允许公钥检索
  - `createDatabaseIfNotExist=true`：若数据库不存在则自动创建

- **用户名和密码**：`spring.datasource.username` 和 `spring.datasource.password` 分别配置数据库访问凭证。默认为 `root` 和 `12345678`，生产环境应修改为安全密码。

- **驱动类名**：`spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver` 指定 MySQL JDBC 驱动。

### 端口与服务器配置

- **服务端口**：`server.port=8080` 设置 Spring Boot 应用监听 8080 端口。
- **上下文路径**：`server.servlet.context-path=/` 设置应用根路径。

### JPA 与数据初始化

- **JPA 配置**：使用 `spring.jpa.hibernate.ddl-auto=update` 实现数据库表结构自动更新。
- **数据初始化**：通过 `spring.sql.init.data-locations=classpath:test-data.sql` 在启动时自动加载测试数据。

**Section sources**
- [application.properties](file://backend/src/main/resources/application.properties#L7-L23)

## 前端环境配置

### 开发服务器配置

前端使用 Vite 作为开发服务器，其配置在 `vite.config.js` 文件中定义：

- **端口配置**：`server.port=3000` 设置前端开发服务器运行在 3000 端口。
- **代理设置**：通过 `server.proxy` 配置 API 请求代理，解决开发环境跨域问题：
  - 所有以 `/api` 开头的请求将被代理到 `http://localhost:8080`
  - `changeOrigin: true` 确保目标服务器接收到正确的 `Origin` 头

### 依赖管理

`package.json` 文件定义了前端依赖：
- **React 18**：核心前端框架
- **Ant Design 5**：UI 组件库
- **Axios**：HTTP 客户端，用于 API 调用
- **Vite**：构建工具和开发服务器

**Section sources**
- [vite.config.js](file://frontend/vite.config.js#L6-L13)
- [package.json](file://frontend/package.json#L6-L11)

## 跨域问题解决方案

本项目采用双重跨域解决方案，确保开发和生产环境的兼容性：

### 后端解决方案

在 `BatchSelectionController.java` 中使用 `@CrossOrigin(origins = "*")` 注解，允许所有来源的跨域请求。这是一种简单直接的解决方案，适用于开发和测试环境。

```mermaid
flowchart TD
A[前端请求] --> B{请求是否包含/api前缀?}
B --> |是| C[Vite代理到后端]
B --> |否| D[直接访问静态资源]
C --> E[后端@CrossOrigin处理]
E --> F[返回数据]
D --> F
```

**Diagram sources**
- [vite.config.js](file://frontend/vite.config.js#L8-L12)
- [BatchSelectionController.java](file://backend/src/main/java/com/example/batchselection/controller/BatchSelectionController.java#L24)

### 前端代理解决方案

Vite 的代理配置作为第二道防线，将 `/api` 请求转发到后端服务。这种配置的优势在于：
- 开发时前端和后端可以独立运行
- 避免浏览器的同源策略限制
- 无需修改前端代码中的 API 地址

**Section sources**
- [BatchSelectionController.java](file://backend/src/main/java/com/example/batchselection/controller/BatchSelectionController.java#L24)
- [vite.config.js](file://frontend/vite.config.js#L8-L12)

## 常见配置问题排查

### 数据库连接失败

**症状**：应用启动时抛出 `Cannot connect to database` 异常。

**排查步骤**：
1. 确认 MySQL 服务已启动
2. 检查 `application.properties` 中的数据库 URL、用户名和密码是否正确
3. 验证数据库 `batch_selection` 是否存在
4. 确保 MySQL 用户有远程连接权限（若非本地连接）

**解决方案**：参考 `README.md` 中的数据库准备步骤，使用 SQL 脚本创建数据库和表结构。

### 端口占用

**症状**：启动时提示 `Port 8080 is already in use`。

**解决方案**：
- 后端：修改 `application.properties` 中的 `server.port`
- 前端：修改 `vite.config.js` 中的 `server.port`

### 依赖安装失败

**症状**：`npm install` 或 `mvn clean install` 失败。

**排查**：
- 检查网络连接和包管理器配置
- 确认 Node.js 和 Maven 版本符合要求
- 清理缓存后重试

**Section sources**
- [README.md](file://README.md#L106-L115)
- [application.properties](file://backend/src/main/resources/application.properties#L8-L10)
- [vite.config.js](file://frontend/vite.config.js#L7)

## 总结

本环境配置指南详细说明了项目开发所需的各项配置。关键要点包括：
- 正确配置 `application.properties` 中的数据库连接参数
- 理解 Vite 代理机制在解决跨域问题中的作用
- 确保 JDK、Node.js 等前置条件满足要求
- 利用 `@CrossOrigin` 和代理双重机制保障 API 可访问性

通过遵循本指南，开发者可以快速搭建开发环境，避免常见的配置问题，提高开发效率。

**Section sources**
- [README.md](file://README.md#L97-L155)